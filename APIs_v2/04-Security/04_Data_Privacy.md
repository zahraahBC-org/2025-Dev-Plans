# Ø§Ù„Ø®ØµÙˆØµÙŠØ© ÙˆØ­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª â€” Data Privacy & Protection
**Ø§Ù„Ø£Ù‡Ù…ÙŠØ© | Importance**: ğŸ”´ Ø­Ø±Ø¬Ø© - Ø¥Ù„Ø²Ø§Ù…ÙŠØ© Ù‚Ø§Ù†ÙˆÙ†ÙŠØ§Ù‹

---

## **Ø§Ù„Ù‡Ø¯Ù | Objective**

Ø¶Ù…Ø§Ù† Ø­Ù…Ø§ÙŠØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„Ø§Ù…ØªØ«Ø§Ù„ Ù„Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ© (GDPRØŒ Ù‚ÙˆØ§Ù†ÙŠÙ† Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª).

---

## **Ø§Ù„Ù…Ø¨Ø§Ø¯Ø¦ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© | Core Principles**

### **1. Data Minimization | ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª**

**Principles:**
- Ø§Ø¬Ù…Ø¹ ÙÙ‚Ø· Ù…Ø§ ØªØ­ØªØ§Ø¬Ù‡
- Ù„Ø§ ØªØ·Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø²Ø§Ø¦Ø¯Ø©
- Ø§Ø­Ø°Ù Ù…Ø§ Ù„Ù… ØªØ¹Ø¯ ØªØ­ØªØ§Ø¬Ù‡

**Example:**
- **DON'T:** Ø·Ù„Ø¨ Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨
- **DO:** Ø·Ù„Ø¨ Ø§Ø³Ù… ÙˆØ¨Ø±ÙŠØ¯ ÙÙ‚Ø·

---

### **2. Privacy by Design | Ø§Ù„Ø®ØµÙˆØµÙŠØ© Ø¨Ø§Ù„ØªØµÙ…ÙŠÙ…**

```
âœ… ØªØ´ÙÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø³Ø©
âœ… Ø¥Ø®ÙØ§Ø¡ PII ÙÙŠ logs
âœ… Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ÙˆØµÙˆÙ„ (RBAC)
âœ… Audit logs Ù„ÙƒÙ„ Ø¹Ù…Ù„ÙŠØ©
```

---

## **Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª | Data Classification**

### **Ø§Ù„ØªØµÙ†ÙŠÙ:**

| Ø§Ù„Ù…Ø³ØªÙˆÙ‰ | Ø£Ù…Ø«Ù„Ø© | Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© |
|---------|-------|----------|
| **Public** | Ø£Ø³Ù…Ø§Ø¡ Ù…Ù†ØªØ¬Ø§ØªØŒ ÙØ¦Ø§Øª | Ø¹Ø§Ù…ØŒ ÙŠÙ…ÙƒÙ† cache |
| **Internal** | Order IDsØŒ statistics | Ø¯Ø§Ø®Ù„ÙŠ ÙÙ‚Ø· |
| **Confidential** | Ø¨Ø±ÙŠØ¯ØŒ Ù‡Ø§ØªÙØŒ Ø¹Ù†ÙˆØ§Ù† | ØªØ´ÙÙŠØ±ØŒ Ù…Ø­Ø¯ÙˆØ¯ Ø§Ù„ÙˆØµÙˆÙ„ |
| **Restricted** | ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±ØŒ Ø¨ÙŠØ§Ù†Ø§Øª Ø¯ÙØ¹ | ØªØ´ÙÙŠØ± Ù‚ÙˆÙŠØŒ audit |

---

## **PII Handling | Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©**

### **Ù…Ø§ Ù‡Ùˆ PIIØŸ**

**Personally Identifiable Information:**
- Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„
- Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
- Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ
- Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
- IP Address
- Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©
- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©

---

### **Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©:**

#### **1. Ø§Ù„ØªØ´ÙÙŠØ± | Encryption**

```php
// At Rest (ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª)
// Refer to Database plan for full schema

// ÙÙŠ Model
class User extends Model
{
    protected $casts = [
        'phone' => 'encrypted',
        'address' => 'encrypted',
    ];
}

// In Transit (Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù†Ù‚Ù„)
// HTTPS ÙÙ‚Ø· - Ù„Ø§ HTTP Ø£Ø¨Ø¯Ø§Ù‹
```

---

#### **2. Masking | Ø§Ù„Ø¥Ø®ÙØ§Ø¡**

```php
// ÙÙŠ Ø§Ù„Ù„ÙˆØº - Ù„Ø§ ØªØ³Ø¬Ù„ PII
Log::info('User registered', [
    'user_id' => $user->id,  // âœ… ID ÙÙ‚Ø·
    // âŒ Ù„Ø§ email, phone, name
]);

// ÙÙŠ Admin Panel - Ø¥Ø®ÙØ§Ø¡ Ø¬Ø²Ø¦ÙŠ
public function getMaskedPhoneAttribute(): string
{
    // 05XXXXXXX12
    return substr($this->phone, 0, 2) . 'XXXXXX' . substr($this->phone, -2);
}

// ÙÙŠ Error messages - Ù„Ø§ PII
return response()->json([
    'message' => 'Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ§Ù„Ø­Ø©',
    // âŒ Ù„Ø§ 'Email john@example.com already exists'
]);
```

---

#### **3. Access Control | Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ÙˆØµÙˆÙ„**

```php
// ÙÙ‚Ø· Ø§Ù„Ù…Ø®ÙˆÙ„ ÙŠÙ…ÙƒÙ†Ù‡ Ø±Ø¤ÙŠØ© PII
class UserPolicy
{
    public function viewSensitiveData(User $viewer, User $target): bool
    {
        // Ù†ÙØ³ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ admin
        return $viewer->id === $target->id 
            || $viewer->hasRole('admin');
    }
}

// ÙÙŠ Resource
class UserResource extends JsonResource
{
    public function toArray($request): array
    {
        return [
            'id' => $this->id,
            'name' => $this->name,
            
            // PII ÙÙ‚Ø· Ù„Ù„Ù…Ø®ÙˆÙ„
            'email' => $this->when(
                $request->user()->can('viewSensitiveData', $this->resource),
                $this->email
            ),
            
            'phone' => $this->when(
                $request->user()->can('viewSensitiveData', $this->resource),
                $this->phone
            ),
        ];
    }
}
```

---

## **Data Retention | Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª**

### **Retention Policies | Ø³ÙŠØ§Ø³Ø§Øª Ø§Ù„Ø§Ø­ØªÙØ§Ø¸**

```php
// config/data-retention.php
return [
    'users' => [
        'inactive_account' => 365,     // Ø­Ø°Ù Ø¨Ø¹Ø¯ Ø³Ù†Ø© Ù…Ù† Ø¹Ø¯Ù… Ø§Ù„Ù†Ø´Ø§Ø·
        'deleted_account' => 30,       // Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ Ø¨Ø¹Ø¯ 30 ÙŠÙˆÙ… Ù…Ù† Ø§Ù„Ø­Ø°Ù
    ],
    'orders' => [
        'completed' => 1825,           // 5 Ø³Ù†ÙˆØ§Øª (Ù…ØªØ·Ù„Ø¨Ø§Øª Ù…Ø­Ø§Ø³Ø¨ÙŠØ©)
        'cancelled' => 365,            // Ø³Ù†Ø© ÙˆØ§Ø­Ø¯Ø©
    ],
    'logs' => [
        'api_logs' => 90,              // 3 Ø£Ø´Ù‡Ø±
        'security_logs' => 365,        // Ø³Ù†Ø©
    ],
];
```

---

### **Auto-deletion Command:**

```php
// app/Console/Commands/ApplyDataRetention.php
class ApplyDataRetention extends Command
{
    protected $signature = 'data:retention';
    
    public function handle(): int
    {
        // Soft-deleted users (Ø¨Ø¹Ø¯ 30 ÙŠÙˆÙ…)
        User::onlyTrashed()
            ->where('deleted_at', '<', now()->subDays(30))
            ->forceDelete();
        
        // Inactive users (Ø¨Ø¹Ø¯ Ø³Ù†Ø©)
        User::where('last_login_at', '<', now()->subYear())
            ->where('is_active', false)
            ->delete();
        
        // Old logs
        DB::table('activity_log')
            ->where('created_at', '<', now()->subDays(90))
            ->delete();
        
        return 0;
    }
}
```

---

## ï¸ **Right to Erasure | Ø­Ù‚ Ø§Ù„Ù†Ø³ÙŠØ§Ù†**

### **GDPR Article 17 - Ø­Ù‚ Ø§Ù„Ø­Ø°Ù**

```php
// app/Services/DataErasureService.php
namespace App\Services;

use App\Models\User;
use Illuminate\Support\Facades\DB;

class DataErasureService
{
    /**
     * Anonymize user data (GDPR compliant)
     */
    public function anonymizeUser(User $user): void
    {
        DB::transaction(function () use ($user) {
            // Anonymize PII
            $user->update([
                'name' => 'User-' . $user->id,
                'email' => 'deleted-' . $user->id . '@example.com',
                'phone' => null,
                'address' => null,
                'deleted_at' => now(),
            ]);
            
            // Anonymize related data
            $user->addresses()->delete();
            $user->tokens()->delete();
            
            // Keep orders Ù„ÙƒÙ† anonymize
            $user->orders()->update([
                'customer_name' => 'Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø­Ø°ÙˆÙ',
                'customer_email' => null,
                'customer_phone' => null,
            ]);
            
            // Log erasure
            activity()
                ->causedBy($user)
                ->log('User data anonymized (GDPR)');
        });
    }
    
    /**
     * Complete data deletion
     */
    public function completeErasure(User $user): void
    {
        DB::transaction(function () use ($user) {
            // Ø­Ø°Ù ÙƒÙ„ Ø´ÙŠØ¡
            $user->orders()->delete();
            $user->reviews()->delete();
            $user->addresses()->delete();
            $user->forceDelete();
        });
    }
}
```

---

### **API Endpoint:**

```php
// Request account deletion (30-day grace period)
public function requestDeletion(Request $request)
{
    $deletion = DeletionRequest::create([
        'user_id' => $request->user()->id,
        'scheduled_at' => now()->addDays(30),
    ]);
    
    Mail::to($request->user())->send(new DeletionRequestedMail($deletion));
    
    return response()->json([
        'message' => 'Ø³ÙŠØªÙ… Ø§Ù„Ø­Ø°Ù Ø®Ù„Ø§Ù„ 30 ÙŠÙˆÙ…Ø§Ù‹',
        'scheduled_at' => $deletion->scheduled_at,
    ]);
}

// Cancel deletion request
public function cancelDeletion($deletionId)
{
    DeletionRequest::findOrFail($deletionId)->update(['status' => 'cancelled']);
    return response()->json(['message' => 'ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡']);
}
```

---

## **Consent Management | Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª**

### **Database Schema:**

```php
// Refer to Database plan for full schema
Schema::create('user_consents', function (Blueprint $table) {
    $table->id();
    $table->foreignId('user_id')->constrained()->onDelete('cascade');
    $table->string('consent_type');  // 'marketing', 'analytics', 'push'
    $table->boolean('granted')->default(false);
    // ... other columns - see Database plan
    $table->timestamps();
});
```

---

### **Model:**

```php
class UserConsent extends Model
{
    protected $fillable = [
        'user_id',
        'consent_type',
        'granted',
        'granted_at',
        'ip_address',
    ];
    
    protected $casts = [
        'granted' => 'boolean',
        'granted_at' => 'datetime',
        'revoked_at' => 'datetime',
    ];
}
```

---

### **API Endpoints:**

```php
// Update consents
public function updateConsents(Request $request)
{
    $request->validate([
        'marketing' => 'required|boolean',
        'analytics' => 'required|boolean',
        'push_notifications' => 'required|boolean',
    ]);
    
    $user = $request->user();
    
    foreach ($request->only(['marketing', 'analytics', 'push_notifications']) as $type => $granted) {
        $user->consents()->updateOrCreate(
            ['consent_type' => $type],
            [
                'granted' => $granted,
                'granted_at' => $granted ? now() : null,
                'revoked_at' => !$granted ? now() : null,
                'ip_address' => $request->ip(),
            ]
        );
    }
    
    return response()->json([
        'success' => true,
        'message' => 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª Ø¨Ù†Ø¬Ø§Ø­',
    ]);
}

// Get consents
public function getConsents(Request $request)
{
    $consents = $request->user()
        ->consents()
        ->pluck('granted', 'consent_type');
    
    return response()->json([
        'success' => true,
        'data' => [
            'marketing' => $consents['marketing'] ?? false,
            'analytics' => $consents['analytics'] ?? false,
            'push_notifications' => $consents['push_notifications'] ?? false,
        ],
    ]);
}
```

---

## **Encryption Standards**

### **At Rest (Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª):**

```php
// Laravel Encryption
class User extends Model
{
    protected $casts = [
        'phone' => 'encrypted',
        'national_id' => 'encrypted',
        'address' => 'encrypted',
    ];
}

// Database encryption (MySQL)
// ÙŠÙÙØ¶Ù„ ØªØ´ÙÙŠØ± Ø§Ù„Ù€database Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ - see Database plan
```

---

### **In Transit (Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ù†Ù‚Ù„):**

**Requirements:**
- HTTPS ÙÙ‚Ø· (TLS 1.2+)
- Ù„Ø§ HTTP Ø£Ø¨Ø¯Ø§Ù‹ ÙÙŠ production
- Certificate valid ÙˆÙ…Ø­Ø¯Ø«

---

### **In Memory (ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø©):**

```php
// ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…
try {
    $sensitiveData = decrypt($encrypted);
    // Use data
} finally {
    unset($sensitiveData);  // Clear Ù…Ù† memory
}
```

---

## **Audit Logging | Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ¯Ù‚ÙŠÙ‚**

### **Ù…Ø§ ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„Ù‡:**

```php
// Audit logging for sensitive data access
class User extends Model
{
    use LogsActivity;
    
    protected static $logAttributes = ['email', 'phone', 'is_active'];
    protected static $logOnlyDirty = true;
    
    // Log when PII is accessed by other users
    protected static function boot()
    {
        parent::boot();
        static::retrieved(fn($user) => 
            activity()->log('Accessed user PII')
        );
    }
}
```

---

### **Activity Log Schema:**

```php
// Refer to Database plan for full schema
Schema::create('activity_log', function (Blueprint $table) {
    $table->id();
    $table->text('description');
    $table->nullableMorphs('subject', 'subject');
    $table->nullableMorphs('causer', 'causer');
    // ... other columns - see Database plan
    $table->timestamps();
});
```

---

## **Ù…Ø§ Ù„Ø§ ÙŠØ¬Ø¨ ÙØ¹Ù„Ù‡ | What NOT to Do**

### ** ÙÙŠ Logs:**

```php
// âŒ Ø®Ø·Ø£ - ØªØ³Ø¬ÙŠÙ„ PII
Log::info('User logged in', [
    'email' => $user->email,        // âŒ
    'phone' => $user->phone,        // âŒ
    'ip' => $request->ip(),         // âš ï¸ PII ÙÙŠ Ø¨Ø¹Ø¶ Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ†
]);

// âœ… ØµØ­ÙŠØ­
Log::info('User logged in', [
    'user_id' => $user->id,         // âœ… ID ÙÙ‚Ø·
    'timestamp' => now(),           // âœ…
]);
```

---

### ** ÙÙŠ Error Messages:**

```php
// âŒ Ø®Ø·Ø£
return response()->json([
    'message' => "User with email {$email} already exists",
]);

// âœ… ØµØ­ÙŠØ­
return response()->json([
    'message' => 'Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹',
    'error_code' => 'EMAIL_EXISTS',
]);
```

---

### ** ÙÙŠ Analytics:**

```php
// âŒ Ø®Ø·Ø£
Analytics::track('Purchase', [
    'user_email' => $user->email,   // âŒ
    'user_phone' => $user->phone,   // âŒ
]);

// âœ… ØµØ­ÙŠØ­
Analytics::track('Purchase', [
    'user_id' => $user->id,         // âœ… pseudonymized
    'amount' => $order->total,
]);
```

---

## **GDPR Compliance Checklist**

### **Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:**

| Ø§Ù„Ø­Ù‚ | Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ | Ø§Ù„Ù€API |
|------|---------|-------|
| **Right to Access** | ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª | GET /me/data-export |
| **Right to Rectification** | ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª | PATCH /me/profile |
| **Right to Erasure** | Ø­Ø°Ù/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª | DELETE /me/account |
| **Right to Restrict** | Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© | PATCH /me/consents |
| **Right to Portability** | ØªØµØ¯ÙŠØ± Ø¨ØµÙŠØºØ© Ù‚ÙŠØ§Ø³ÙŠØ© | GET /me/data-export?format=json |

---

### **API Endpoints Ù„Ù„Ù€GDPR:**

```php
// ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
public function exportData(Request $request)
{
    $user = $request->user();
    
    $data = [
        'personal_info' => [
            'name' => $user->name,
            'email' => $user->email,
            'phone' => $user->phone,
            'created_at' => $user->created_at,
        ],
        'orders' => $user->orders()->get(),
        'addresses' => $user->addresses()->get(),
        'reviews' => $user->reviews()->get(),
    ];
    
    return response()->json([
        'success' => true,
        'data' => $data,
    ])->header('Content-Disposition', 'attachment; filename=user-data.json');
}

// Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨
public function deleteAccount(DeleteAccountRequest $request)
{
    $user = $request->user();
    
    // Verify password
    if (!Hash::check($request->password, $user->password)) {
        return response()->json([
            'success' => false,
            'message' => 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©',
        ], 403);
    }
    
    // Create deletion request
    app(DataErasureService::class)->requestDeletion($user);
    
    return response()->json([
        'success' => true,
        'message' => 'Ø³ÙŠØªÙ… Ø­Ø°Ù Ø­Ø³Ø§Ø¨Ùƒ Ø®Ù„Ø§Ù„ 30 ÙŠÙˆÙ…Ø§Ù‹',
    ]);
}
```

---

## **Security Best Practices**

### **1. Ù„Ø§ ØªÙØ³Ø±Ù‘Ø¨ PII:**

```php
// âœ… ØµØ­ÙŠØ­ - responses Ø¢Ù…Ù†Ø©
return response()->json([
    'success' => false,
    'message' => 'Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ§Ù„Ø­Ø©',
]);

// âŒ Ø®Ø·Ø£ - ØªØ³Ø±ÙŠØ¨ PII
return response()->json([
    'message' => "User {$email} not found",
]);
```

---

### **2. Sanitize Ù‚Ø¨Ù„ Ø§Ù„ØªØ®Ø²ÙŠÙ†:**

```php
use Illuminate\Support\Str;

$user->name = Str::of($request->name)
    ->trim()
    ->limit(255)
    ->stripTags()
    ->value();
```

---

### **3. Rate Limiting Ø¹Ù„Ù‰ PII:**

```php
// Ø­Ù…Ø§ÙŠØ© endpoints Ø§Ù„Ø­Ø³Ø§Ø³Ø©
Route::middleware(['throttle:sensitive'])->group(function () {
    Route::get('/me/data-export', [UserController::class, 'exportData']);
    Route::delete('/me/account', [UserController::class, 'deleteAccount']);
});

// ÙÙŠ RouteServiceProvider
RateLimiter::for('sensitive', function (Request $request) {
    return Limit::perDay(5)->by($request->user()->id);
});
```

---

## **Privacy Policy API**

### **Ø¹Ø±Ø¶ Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©:**

```php
public function privacyPolicy()
{
    return response()->json([
        'success' => true,
        'data' => [
            'version' => '1.0',
            'last_updated' => '2025-10-19',
            'url' => 'https://example.com/privacy',
            'sections' => [
                'data_collection' => 'Ù…Ø§ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªÙŠ Ù†Ø¬Ù…Ø¹Ù‡Ø§',
                'data_usage' => 'ÙƒÙŠÙ Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª',
                'data_sharing' => 'Ù…Ø¹ Ù…Ù† Ù†Ø´Ø§Ø±Ùƒ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª',
                'user_rights' => 'Ø­Ù‚ÙˆÙ‚Ùƒ',
                'contact' => 'ÙƒÙŠÙ ØªØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§',
            ],
        ],
    ]);
}
```

---

## **Testing Privacy**

```php
class PrivacyTest extends TestCase
{
    public function test_pii_not_in_logs(): void
    {
        Log::shouldReceive('info')
            ->once()
            ->withArgs(function ($message, $context) {
                // ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ù€context Ù„Ø§ ÙŠØ­ØªÙˆÙŠ email Ø£Ùˆ phone
                return !isset($context['email']) 
                    && !isset($context['phone']);
            });
        
        $this->postJson('/api/v1/register', [
            'email' => 'test@example.com',
            'phone' => '0501234567',
        ]);
    }
    
    public function test_user_can_export_data(): void
    {
        $user = User::factory()->create();
        
        $response = $this->actingAs($user, 'sanctum')
            ->getJson('/api/v1/me/data-export');
        
        $response->assertStatus(200)
            ->assertJsonStructure([
                'data' => [
                    'personal_info',
                    'orders',
                    'addresses',
                ],
            ]);
    }
    
    public function test_user_can_request_deletion(): void
    {
        $user = User::factory()->create();
        
        $response = $this->actingAs($user, 'sanctum')
            ->deleteJson('/api/v1/me/account', [
                'password' => 'password',
            ]);
        
        $response->assertStatus(200);
        
        $this->assertDatabaseHas('deletion_requests', [
            'user_id' => $user->id,
            'status' => 'pending',
        ]);
    }
}
```

---

## **Checklist Ø§Ù„Ø§Ù…ØªØ«Ø§Ù„ | Compliance Checklist**

### **GDPR/Privacy:**
- [ ] PII encrypted at rest
- [ ] HTTPS only (TLS 1.2+)
- [ ] PII masked ÙÙŠ logs
- [ ] PII masked ÙÙŠ admin panel
- [ ] Access control (RBAC)
- [ ] Audit logging Ù„Ù€PII access

### **User Rights:**
- [ ] Right to access (data export)
- [ ] Right to rectification (update profile)
- [ ] Right to erasure (delete account)
- [ ] Right to restrict (consents)
- [ ] Right to portability (JSON export)

### **Retention:**
- [ ] Retention policies Ù…Ø­Ø¯Ø¯Ø©
- [ ] Auto-deletion Ù…Ø¬Ø¯ÙˆÙ„
- [ ] Soft delete Ø£ÙˆÙ„Ø§Ù‹ (grace period)
- [ ] Force delete Ø¨Ø¹Ø¯ Ø§Ù„ÙØªØ±Ø©

### **Consents:**
- [ ] Consent management API
- [ ] Opt-in/opt-out ÙˆØ§Ø¶Ø­
- [ ] Audit trail Ù„Ù„Ù…ÙˆØ§ÙÙ‚Ø§Øª
- [ ] Respect consents ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚

---

**Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ« | Last Updated**: October 20, 2025  
**Ø§Ù„Ø¥ØµØ¯Ø§Ø± | Version**: 2.0
